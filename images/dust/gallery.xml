<tiltviewergallery>
<photos id='photos'>
	<photo imageurl="images/img_01.jpg" linkurl="http://www.baidu.com">
		<title>Image 1</title>
		<!--<description>This is a regular text description.</description>-->
	</photo>
	<photo imageurl="images/img_02.jpg" linkurl="http://www.baidu.com">
		<title>Image 2</title>
		<!--<description><![CDATA[This is a HTML text description. Supported tags are <b>bold</b>, <u>underline</u>, <i>italics</i>, linebreaks<br>and <font color="#ff0000" size="60">font tags</font>. Hyperlinks are not supported.]]></description>-->
	</photo>
	<photo imageurl="images/img_03.jpg" linkurl="http://www.baidu.com">
		<title>Image 3</title>
	<!--<description>This image has no link button becasue the 'linkurl' property was removed from the photo tag</description>-->			
	</photo>
	<photo imageurl="images/img_04.jpg" linkurl="http://www.baidu.com" ><!--showFlipButton="ture"-->
		<title>Image 4</title>
		<!--<description>This image has no flip button because the 'showFlipButton' property was added to the photo tag</description>		-->
	</photo>
	<photo imageurl="images/img_05.jpg" linkurl="http://www.baidu.com">
		<title>Image 5</title>			
	</photo>
	<photo imageurl="images/img_06.jpg" linkurl="http://www.baidu.com">
		<title>Image 6</title>			
	</photo>
	<photo imageurl="images/img_07.jpg" linkurl="http://www.baidu.com">
		<title>Image 7</title>			
	</photo>
	<photo imageurl="images/img_08.jpg" linkurl="http://www.baidu.com">
		<title>Image 8</title>			
	</photo>
	<photo imageurl="images/img_09.jpg" linkurl="http://www.baidu.com">
		<title>Image 9</title>			
	</photo>
	<photo imageurl="images/img_10.jpg" linkurl="http://www.baidu.com">
		<title>Image 10</title>			
	</photo>
	<photo imageurl="images/img_11.jpg" linkurl="http://www.baidu.com">
		<title>Image 11</title>			
	</photo>
	<photo imageurl="images/img_12.jpg" linkurl="http://www.baidu.com">
		<title>Image 12</title>			
	</photo>
	<photo imageurl="images/img_13.jpg" linkurl="http://www.baidu.com">
		<title>Image 13</title>			
	</photo>
	<photo imageurl="images/img_14.jpg" linkurl="http://www.baidu.com">
		<title>Image 14</title>			
	</photo>	
	<photo imageurl="images/img_15.jpg" linkurl="http://www.baidu.com">
		<title>Image 15</title>			
	</photo>
	<photo imageurl="images/img_16.jpg" linkurl="http://www.baidu.com">
		<title>Image 16</title>
	</photo>
	<photo imageurl="images/img_17.jpg" linkurl="http://www.baidu.com">
		<title>Image 17</title>
	</photo>
	<photo imageurl="images/img_18.jpg" linkurl="http://www.baidu.com">
		<title>Image 18</title>
	</photo>
	<photo imageurl="images/img_19.jpg" linkurl="http://www.baidu.com">
		<title>Image 19</title>
	</photo>
	<photo imageurl="images/img_20.jpg" linkurl="http://www.baidu.com">
		<title>Image 20</title>
	</photo>
	<photo imageurl="images/img_21.jpg" linkurl="http://www.baidu.com">
		<title>Image 21</title>
	</photo>
	<photo imageurl="images/img_22.jpg" linkurl="http://www.baidu.com">
		<title>Image 22</title>
	</photo>
	<photo imageurl="images/img_23.jpg" linkurl="http://www.baidu.com">
		<title>Image 23</title>
	</photo>
	<photo imageurl="images/img_24.jpg" linkurl="http://www.baidu.com">
		<title>Image 24</title>
	</photo>
	<photo imageurl="images/img_25.jpg" linkurl="http://www.baidu.com">
		<title>Image 25</title>
	</photo>
	<photo imageurl="images/lanren.jpg" linkurl="http://www.baidu.com">
		<!--<title>Image 26</title>
		<description>You can visit www.17sucai.com for more info.</description>-->
	</photo>
</photos>
</tiltviewergallery>

<script>
$(function() {
	var oContainer = $('#photos');
	var iCells = 0;
	var imageWidth = 220;
	var iWidth = 244;
	var iSpace = 20;
	var iOuterWidth = iWidth + iSpace;
	var arrT   = [];
	var arrL   = [];
	var iPage  = 1;
	var iBtn   = true;
	var iColor = "";
	var pUrl   = GetImageURL + "/";
	var sUrl   = "";
	var maxH   = 0;

	function fRandomBy(under, over){
	    switch(arguments.length){
	        case 1: return parseInt(Math.random()*under+1);
	        case 2: return parseInt(Math.random()*(over-under+1) + under);
	        default: return 0;
	    }
	}
    
	function setCell() {
		var widthstr = $(".container").css("width");
		if (widthstr) {
			var width    = widthstr.substring(0, widthstr.length -2);
			iCells = Math.floor(width / iOuterWidth);
		} else {
			iCells = Math.floor($(window).innerWidth() / iOuterWidth);
		}
		if (iCells < 1) {
			iCells = 1;
		}
		oContainer.css('width', iCells * iOuterWidth - iSpace);
	}

	setCell();
	
	for (var i=0; i<iCells; i++) {
		arrT[i] = 0;
		arrL[i] = iOuterWidth * i;
	}

	function getData() {
		if (!iBtn) {
			return ;
		}
		iBtn = false;
		sUrl = pUrl + iPage;
		iPage++;
		$.getJSON(sUrl, function(jData) {
			if ($.isEmptyObject(jData)) {
				return;
			};
			$('#loader').show();
			$.each(jData, function(index, obj) {

				var viewUrl = Home + 'view/' + obj.viewid;
				var userUrl = Home + '/' + obj.user;
				
				var objuser =obj.user;

				setTimeout(function() {
					$('#loader').hide();
				},1000)
				iBtn = true;
			})
		});
	}

	getData();

	function getMin() {
		var v = arrT[0];
		var _index = 0;
		
		for (var i=1; i<arrT.length; i++) {
			if (arrT[i] < v) {
				v = arrT[i];
				_index = i;
			}
		}
		return _index;
	}
	
	$(window).on('scroll', function() {
		if (maxH <= $(window).scrollTop()) {
			maxH = $(window).scrollTop();
		}

		var _index =getMin();
		var iH = $(window).scrollTop() + $(window).innerHeight();
		if (arrT[_index] + 50 < iH) {
			getData();
		}
	})
	
	$(window).on('resize', function() {
		var iLen = iCells;
		setCell();
		if (iLen == iCells) {
			return ;
		}
		arrT = [];
		arrL = [];
		for (var i=0; i<iCells; i++) {
			arrT[i] = 0;
			arrL[i] = iOuterWidth * i;
		}
		oContainer.find('div').each(function() {
			
			var _index = getMin();

			$(this).animate({
				left	:	arrL[_index],
				top		:	arrT[_index]
			}, 1000);
			arrT[_index] += $(this).height() + 12;
			
		});
	})
})
</script>